<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simulado Contabilidade (CPC 16, 25 e PECLD) — Feedback Inteligente</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--success:#10b981;--danger:#ef4444;--muted:#94a3b8}
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071128 0%, #071a2a 100%);color:#e6efF6}
    .wrap{max-width:920px;margin:40px auto;padding:24px}
    header{display:flex;align-items:center;gap:16px}
    header h1{margin:0;font-size:20px}
    .card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);padding:18px;border-radius:12px;margin-top:18px}
    .question-area{min-height:180px}
    .alternativas{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .alt{background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);cursor:pointer}
    .alt.selected{outline:2px solid rgba(6,182,212,0.18);background:rgba(6,182,212,0.04)}
    .controls{display:flex;gap:8px;margin-top:14px}
    button{background:var(--accent);color:#012; border:none;padding:10px 14px;border-radius:8px;cursor:pointer; font-weight: 600;}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    button:disabled{opacity:0.5;cursor:not-allowed}
    .summary{display:grid;grid-template-columns:1fr 320px;gap:16px;margin-top:18px}
    .progress{height:10px;background:rgba(255,255,255,0.03);border-radius:6px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#7c3aed);width:0%;transition:width 0.3s ease}
    .insights{font-size:14px;color:var(--muted)}
    .tag{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:12px;color:var(--muted);margin-right:6px}
    .result-score{font-size:32px;margin:0}
    footer{margin-top:24px;text-align:center;color:var(--muted);font-size:13px}
    @media(max-width:860px){.summary{grid-template-columns:1fr;}.wrap{padding:12px}}
  </style>
</head>
<body>
  <div class="wrap">
    
    <div style="text-align: center; margin-bottom: 20px;">
        <img src="https://cdn.dribbble.com/userupload/21464681/file/original-f6ebfdc418f96b396288ccb013c1c339.gif" 
             alt="Animação do Calcifer" 
             style="width: 120px; height: 120px; border-radius: 50%;">
    </div>

    <header>
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='42' height='42'><rect rx='8' width='42' height='42' fill='%2306b6d4'/></svg>" alt="logo" style="width:42px;height:42px;border-radius:8px">
      <div>
        <h1>Simulado Contabilidade — VRL, PECLD e Provisões (Estilo FGV)</h1>
        <div style="color:var(--muted);font-size:13px">20 questões — feedback por disciplina e dicas de estudo</div>
      </div>
    </header>

    <section class="card" id="app">
      <div class="question-area" id="questionArea">
        </div>

      <div class="controls">
        <button id="prevBtn" class="ghost">◀ Anterior</button>
        <button id="nextBtn">Próxima ▶</button>
        <button id="submitBtn" class="ghost" style="margin-left:auto">Enviar respostas</button>
        <button id="resetBtn" class="ghost">Reiniciar</button>
      </div>

      <div class="summary" id="summary" style="display:none">
        <div class="card" style="padding:14px">
          <h3>Resumo</h3>
          <div style="margin-top:8px">
            <div class="progress"><i id="progressBar"></i></div>
            <div style="display:flex;justify-content:space-between;margin-top:8px">
              <small class="insights" id="progressText">0 / 20 respondidas</small>
              <small class="insights" id="correctText">0 corretas</small>
            </div>
          </div>

          <div style="margin-top:12px">
            <h4 style="margin:0 0 8px 0">Insights</h4>
            <div id="insightsList" class="insights">—</div>
          </div>
        </div>

        <div class="card" style="padding:14px">
          <h3>Score</h3>
          <p class="result-score" id="score">0 / 20</p>
          <div style="margin-top:8px">
            <h4 style="margin:6px 0">Pontos para melhorar</h4>
            <div id="weaknesses">—</div>
          </div>
        </div>
      </div>
    </section>

    <footer>
      Projetado para ser hospedado no GitHub Pages. Questões adaptadas para evitar violação de direitos autorais.
    </footer>
  </div>

  <script>
  // QUESTÕES: adaptadas de concursos da banca FGV.
  const questoes = [
    // CPC 16 (VRL) - 7 Questões
    {
      id: 1,
      categoria: 'Contabilidade - CPC 16 (VRL)',
      nivel: 'Fácil',
      enunciado: 'De acordo com o CPC 16 (R1), o Valor Realizável Líquido (VRL) é definido como:',
      alternativas: [
        'O preço de compra de um item de estoque no mercado.',
        'O preço de venda estimado no curso normal dos negócios, deduzido das despesas de venda.',
        'O preço de venda estimado, deduzido dos custos estimados para sua conclusão e dos gastos necessários para concretizar a venda.',
        'O valor justo do estoque menos os custos de vendê-lo.',
        'O custo histórico do estoque ajustado pela inflação do período.'
      ],
      correta: 2,
      explicacao: 'A definição correta e completa do VRL é o preço de venda estimado menos os custos para finalizar a produção (se houver) e os gastos para vender (comissões, fretes, marketing etc.).'
    },
    {
      id: 2,
      categoria: 'Contabilidade - CPC 16 (VRL)',
      nivel: 'Médio',
      enunciado: 'Uma empresa possui um produto em estoque com custo de R$ 500. O preço de venda estimado é de R$ 600. Para vender o produto, a empresa incorrerá em comissões de R$ 30 e frete de R$ 20. Qual valor deve ser registrado para este item no balanço?',
      alternativas: [
        'R$ 600',
        'R$ 550',
        'R$ 500',
        'R$ 530',
        'R$ 450'
      ],
      correta: 2,
      explicacao: 'O VRL é R$ 600 (preço de venda) - R$ 30 (comissão) - R$ 20 (frete) = R$ 550. Compara-se o Custo (R$ 500) com o VRL (R$ 550). O estoque deve ser mensurado pelo menor dos dois, que neste caso é o Custo de R$ 500.'
    },
    {
      id: 3,
      categoria: 'Contabilidade - CPC 16 (VRL)',
      nivel: 'Médio',
      enunciado: 'Considere o mesmo cenário da questão anterior, mas agora o preço de venda estimado caiu para R$ 540. Qual ajuste a empresa deve fazer em seu resultado?',
      alternativas: [
        'Nenhum ajuste, pois o preço de venda ainda é maior que o custo.',
        'Reconhecer uma perda de R$ 10 no resultado do período.',
        'Reconhecer um ganho de R$ 40.',
        'Reconhecer uma perda de R$ 50.',
        'Aguardar a venda para realizar qualquer ajuste.'
      ],
      correta: 1,
      explicacao: 'O novo VRL é R$ 540 (preço de venda) - R$ 30 (comissão) - R$ 20 (frete) = R$ 490. Compara-se o Custo (R$ 500) com o VRL (R$ 490). O estoque deve ser ajustado para o menor valor (R$ 490), reconhecendo uma perda por desvalorização de R$ 10 (R$ 500 - R$ 490).'
    },
     {
      id: 4,
      categoria: 'Contabilidade - CPC 16 (VRL)',
      nivel: 'Difícil',
      enunciado: 'A regra de mensuração dos estoques pelo "custo ou valor realizável líquido, dos dois o menor" deve ser aplicada:',
      alternativas: [
        'Ao estoque total da empresa, de forma agregada.',
        'Item a item, individualmente.',
        'Por grupos de itens similares ou relacionados.',
        'Item a item, ou por grupos de itens similares, mas não de forma agregada.',
        'Apenas para produtos acabados.'
      ],
      correta: 3,
      explicacao: 'O CPC 16 orienta que a comparação deve ser feita item a item. No entanto, permite-se o agrupamento de itens similares ou relacionados (ex: uma mesma linha de produtos), mas proíbe a avaliação com base no estoque total ou por classes muito amplas.'
    },
    {
      id: 5,
      categoria: 'Contabilidade - CPC 16 (VRL)',
      nivel: 'Médio',
      enunciado: 'Qual das seguintes situações NÃO levaria a uma redução do valor do estoque para o VRL?',
      alternativas: [
        'Um aumento significativo nos custos para finalizar a produção do item.',
        'Danos físicos sofridos por parte do estoque.',
        'Obsolescência tecnológica do produto.',
        'Aumento inesperado no preço de venda do produto.',
        'Queda acentuada na demanda do mercado pelo produto.'
      ],
      correta: 3,
      explicacao: 'Um aumento no preço de venda tende a aumentar o VRL. As outras opções (aumento de custo, danos, obsolescência e queda na demanda) são todos fatores que podem fazer com que o VRL se torne inferior ao custo, exigindo um ajuste de perda.'
    },
    {
      id: 6,
      categoria: 'Contabilidade - CPC 16 (VRL)',
      nivel: 'Difícil',
      enunciado: 'Uma empresa reconheceu uma perda por desvalorização de estoque de R$ 2.000 no ano X1. Em X2, as condições de mercado melhoraram. A reversão da perda:',
      alternativas: [
        'Não é permitida em nenhuma hipótese.',
        'É permitida e deve ser reconhecida diretamente no Patrimônio Líquido.',
        'É permitida, limitada ao valor da perda original, e afeta o Custo do Produto Vendido (CPV).',
        'É permitida sem qualquer limite de valor.',
        'É permitida, mas reconhecida como "Outras Receitas Operacionais".'
      ],
      correta: 2,
      explicacao: 'O CPC 16 permite a reversão de perdas. A reversão é limitada ao valor da perda original e é reconhecida como uma redução no CPV do período em que ocorre, melhorando o resultado.'
    },
    {
      id: 7,
      categoria: 'Contabilidade - CPC 16 (VRL)',
      nivel: 'Médio',
      enunciado: 'Para matérias-primas que serão utilizadas na produção, o teste do VRL é aplicado de que forma?',
      alternativas: [
        'Elas nunca são testadas, pois não são para venda.',
        'O VRL da matéria-prima é sempre o seu custo de reposição.',
        'A matéria-prima só é ajustada se o produto acabado no qual será incorporada for vendido com prejuízo.',
        'O VRL é calculado com base em seu preço de venda no mercado de commodities.',
        'Aplica-se a mesma regra dos produtos acabados, sem exceções.'
      ],
      correta: 2,
      explicacao: 'A matéria-prima não é ajustada ao VRL se o produto acabado em que ela será usada for vendido por um preço igual ou superior ao seu custo. A necessidade de ajuste só surge se o produto final tiver um VRL inferior ao seu próprio custo.'
    },
    // PECLD - 7 Questões
    {
      id: 8,
      categoria: 'Contabilidade - PECLD',
      nivel: 'Fácil',
      enunciado: 'O modelo de Perdas Esperadas em Créditos de Liquidação Duvidosa (PECLD) representa uma mudança em relação ao modelo anterior, de perdas incorridas. A principal característica do modelo de perdas esperadas é ser:',
      alternativas: [
        'Reativo, reconhecendo a perda apenas após a inadimplência.',
        'Conservador, sempre provisionando 100% das contas a receber.',
        'Prospectivo, exigindo uma análise de informações futuras para estimar perdas.',
        'Opcional para a maioria das empresas.',
        'Baseado exclusivamente no histórico de perdas da empresa.'
      ],
      correta: 2,
      explicacao: 'A grande mudança do modelo de perdas esperadas (Expected Credit Losses - ECL) é sua natureza prospectiva (forward-looking), que exige que as entidades considerem não só o passado, mas também as condições atuais e as previsões futuras para estimar as perdas.'
    },
    {
      id: 9,
      categoria: 'Contabilidade - PECLD',
      nivel: 'Médio',
      enunciado: 'Uma empresa possui um saldo de Contas a Receber de R$ 200.000. Com base em sua matriz de provisionamento, que considera o histórico e as condições econômicas futuras, ela estima uma perda de 5% sobre esse saldo. Qual o lançamento contábil para registrar a PECLD?',
      alternativas: [
        'D - Caixa R$ 10.000 / C - Contas a Receber R$ 10.000',
        'D - Despesa com PECLD R$ 10.000 / C - Contas a Receber R$ 10.000',
        'D - Contas a Receber R$ 10.000 / C - Receita Financeira R$ 10.000',
        'D - Despesa com PECLD R$ 10.000 / C - PECLD (conta retificadora) R$ 10.000',
        'D - PECLD (conta retificadora) R$ 10.000 / C - Despesa com PECLD R$ 10.000'
      ],
      correta: 3,
      explicacao: 'A despesa com a perda estimada é reconhecida no resultado. A contrapartida é uma conta retificadora do ativo (PECLD), que reduz o saldo de Contas a Receber ao seu valor realizável líquido. O cálculo da perda é R$ 200.000 * 5% = R$ 10.000.'
    },
    {
      id: 10,
      categoria: 'Contabilidade - PECLD',
      nivel: 'Médio',
      enunciado: 'No início do ano, uma empresa tinha um saldo de R$ 5.000 em sua conta de PECLD. Durante o ano, registrou R$ 8.000 de novas estimativas de perdas e deu baixa em R$ 3.000 de duplicatas consideradas incobráveis. Qual o saldo final da conta PECLD?',
      alternativas: [
        'R$ 10.000',
        'R$ 13.000',
        'R$ 16.000',
        'R$ 8.000',
        'R$ 5.000'
      ],
      correta: 0,
      explicacao: 'O saldo final é calculado como: Saldo Inicial + Novas Provisões - Baixas por Inadimplência. Cálculo: R$ 5.000 + R$ 8.000 - R$ 3.000 = R$ 10.000. A baixa de uma duplicata utiliza o saldo já provisionado.'
    },
     {
      id: 11,
      categoria: 'Contabilidade - PECLD',
      nivel: 'Difícil',
      enunciado: 'De acordo com a abordagem simplificada permitida para contas a receber comerciais, a perda esperada é geralmente medida com base em:',
      alternativas: [
        'Uma análise individual de cada cliente, obrigatoriamente.',
        'Perdas esperadas para os próximos 12 meses.',
        'Perdas esperadas durante toda a vida do ativo financeiro.',
        'Uma taxa fixa de 1% sobre o faturamento, definida pela legislação fiscal.',
        'Apenas quando o risco de crédito aumenta significativamente.'
      ],
      correta: 2,
      explicacao: 'A abordagem simplificada, comumente aplicada a contas a receber de clientes, permite (e muitas vezes exige) que a empresa meça a perda esperada com base na vida inteira (lifetime ECL) do ativo, geralmente usando uma matriz de provisionamento por faixa de vencimento.'
    },
    {
      id: 12,
      categoria: 'Contabilidade - PECLD',
      nivel: 'Médio',
      enunciado: 'A reversão de uma PECLD anteriormente constituída ocorre quando:',
      alternativas: [
        'A empresa decide mudar seu método de cálculo.',
        'O cliente efetivamente não paga a dívida.',
        'A estimativa de perda diminui devido à melhora nas condições de crédito ou pagamento do cliente.',
        'A reversão de PECLD não é permitida.',
        'Ocorre o encerramento do exercício social.'
      ],
      correta: 2,
      explicacao: 'Se a estimativa de perda futura diminuir (por exemplo, a economia melhora ou o cliente renegocia a dívida), o valor provisionado em excesso deve ser revertido, sendo reconhecido como uma receita (reversão de despesa) no resultado.'
    },
     {
      id: 13,
      categoria: 'Contabilidade - PECLD',
      nivel: 'Difícil',
      enunciado: 'O modelo de impairment do IFRS 9 (CPC 48) possui 3 estágios. Um ativo financeiro é movido do Estágio 1 para o Estágio 2 quando:',
      alternativas: [
        'O ativo é originado ou adquirido.',
        'Ocorre um aumento significativo no risco de crédito desde o reconhecimento inicial.',
        'Há evidência objetiva de perda (inadimplência).',
        'O ativo é liquidado.',
        'O valor justo do ativo aumenta.'
      ],
      correta: 1,
      explicacao: 'No Estágio 1, a perda esperada é calculada para 12 meses. Quando há um aumento significativo no risco de crédito (mas ainda não há inadimplência), o ativo move-se para o Estágio 2, e a perda esperada passa a ser calculada para a vida inteira do ativo.'
    },
    {
      id: 14,
      categoria: 'Contabilidade - PECLD',
      nivel: 'Fácil',
      enunciado: 'Qual o principal objetivo da constituição da PECLD?',
      alternativas: [
        'Reduzir o lucro da empresa para pagar menos impostos.',
        'Apresentar o saldo de Contas a Receber pelo seu valor de custo.',
        'Ajustar o saldo de Contas a Receber ao valor que a empresa efetivamente espera receber.',
        'Aumentar o endividamento da companhia.',
        'Registrar uma despesa apenas quando o cliente se torna insolvente.'
      ],
      correta: 2,
      explicacao: 'O objetivo da PECLD é garantir que os ativos financeiros (como Contas a Receber) não estejam superavaliados no balanço, refletindo de forma mais fidedigna o montante que a empresa realisticamente espera converter em caixa.'
    },
    // CPC 25 (Provisões) - 6 Questões
    {
      id: 15,
      categoria: 'Contabilidade - CPC 25 (Provisões)',
      nivel: 'Fácil',
      enunciado: 'De acordo com o CPC 25, qual das seguintes condições NÃO é necessária para o reconhecimento de uma provisão?',
      alternativas: [
        'A empresa tem uma obrigação presente (legal ou não formalizada) como resultado de um evento passado.',
        'É provável que uma saída de recursos seja necessária para liquidar a obrigação.',
        'Uma estimativa confiável do valor da obrigação pode ser feita.',
        'A saída de recursos para liquidar a obrigação é praticamente certa.',
        'O evento que deu origem à obrigação já ocorreu.'
      ],
      correta: 3,
      explicacao: 'Os três critérios para reconhecer uma provisão são: (1) obrigação presente de evento passado, (2) saída de recursos provável (mais provável que não), e (3) estimativa confiável. A certeza da saída de recursos não é exigida, apenas a probabilidade.'
    },
    {
      id: 16,
      categoria: 'Contabilidade - CPC 25 (Provisões)',
      nivel: 'Médio',
      enunciado: 'Uma empresa está enfrentando um processo judicial. Seus advogados consideram a perda como "possível", mas não "provável". Como a empresa deve tratar essa situação em suas demonstrações contábeis?',
      alternativas: [
        'Reconhecer uma provisão no passivo pelo valor estimado da perda.',
        'Não fazer nada, pois a perda não é provável.',
        'Reconhecer um ativo contingente.',
        'Divulgar a existência de um passivo contingente em nota explicativa.',
        'Registrar a despesa imediatamente no resultado.'
      ],
      correta: 3,
      explicacao: 'Quando a saída de recursos é "possível" (e não "provável"), a obrigação não é provisionada no balanço. Em vez disso, ela deve ser divulgada como um passivo contingente nas notas explicativas, detalhando a natureza e a estimativa do efeito financeiro.'
    },
    {
      id: 17,
      categoria: 'Contabilidade - CPC 25 (Provisões)',
      nivel: 'Difícil',
      enunciado: 'Qual a principal diferença entre uma provisão e um passivo de "contas a pagar"?',
      alternativas: [
        'Provisões são sempre de longo prazo, enquanto contas a pagar são de curto prazo.',
        'Não há diferença, os termos são intercambiáveis.',
        'Contas a pagar se referem a obrigações de valor e prazo definidos, enquanto provisões têm incerteza quanto ao prazo ou ao valor.',
        'Provisões são registradas no Patrimônio Líquido.',
        'Contas a pagar não exigem saída de caixa.'
      ],
      correta: 2,
      explicacao: 'A principal distinção é a incerteza. Um "contas a pagar" (ex: fornecedores) é um passivo com valor e vencimento conhecidos. Uma provisão é um passivo com incerteza sobre o valor exato ou a data de liquidação (ex: provisão para garantias).'
    },
    {
      id: 18,
      categoria: 'Contabilidade - CPC 25 (Provisões)',
      nivel: 'Médio',
      enunciado: 'Uma empresa oferece garantia de um ano em seus produtos. Com base na experiência passada, a empresa estima que 2% das vendas gerarão custos com garantia. Se as vendas do ano foram de R$ 1.000.000, qual provisão deve ser constituída?',
      alternativas: [
        'Nenhuma, pois o custo ainda não ocorreu.',
        'Uma provisão de R$ 1.000.000.',
        'Uma provisão de R$ 20.000.',
        'Um passivo contingente de R$ 20.000.',
        'Aguardar os clientes reclamarem para registrar a despesa.'
      ],
      correta: 2,
      explicacao: 'A venda (evento passado) criou uma obrigação (de consertar produtos). A saída de recursos é provável e pode ser estimada confiavelmente. Portanto, uma provisão deve ser reconhecida. Valor = R$ 1.000.000 * 2% = R$ 20.000.'
    },
     {
      id: 19,
      categoria: 'Contabilidade - CPC 25 (Provisões)',
      nivel: 'Difícil',
      enunciado: 'Uma empresa tem uma ação judicial movida por um ex-funcionário. A perda é avaliada como provável, com uma estimativa de valor entre R$ 80.000 e R$ 120.000. Nenhum valor dentro desse intervalo é mais provável que outro. Qual valor a empresa deve provisionar?',
      alternativas: [
        'R$ 120.000, pelo princípio do conservadorismo.',
        'R$ 80.000, o valor mínimo do intervalo.',
        'R$ 100.000, o ponto médio do intervalo.',
        'Nenhum, pois o valor exato não é conhecido.',
        'Divulgar em nota explicativa, mas não provisionar.'
      ],
      correta: 2,
      explicacao: 'Quando há um intervalo de valores igualmente prováveis, o CPC 25 orienta que a melhor estimativa seja o ponto médio desse intervalo. Portanto, (R$ 80.000 + R$ 120.000) / 2 = R$ 100.000. Se houvesse um valor mais provável, este seria o usado.'
    },
    {
      id: 20,
      categoria: 'Contabilidade - CPC 25 (Provisões)',
      nivel: 'Médio',
      enunciado: 'Ativos contingentes devem ser:',
      alternativas: [
        'Reconhecidos no balanço patrimonial se a entrada de benefícios for provável.',
        'Reconhecidos no balanço apenas se a entrada de benefícios for praticamente certa.',
        'Sempre ignorados nas demonstrações contábeis.',
        'Divulgados em nota explicativa se a entrada de benefícios for provável.',
        'Registrados como uma receita antecipada.'
      ],
      correta: 3,
      explicacao: 'Ativos contingentes não são reconhecidos no balanço para evitar o reconhecimento de receitas que talvez nunca se realizem. Eles devem ser apenas divulgados em nota explicativa quando a entrada de benefícios econômicos for provável (e não praticamente certa).'
    }
  ];

  // Estado
  let estado = { index: 0, respostas: Array(questoes.length).fill(null) };

  // Elementos
  const questionArea = document.getElementById('questionArea');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const submitBtn = document.getElementById('submitBtn');
  const resetBtn = document.getElementById('resetBtn');
  const summaryEl = document.getElementById('summary');
  const progressBar = document.getElementById('progressBar');
  const progressText = document.getElementById('progressText');
  const correctText = document.getElementById('correctText');
  const insightsList = document.getElementById('insightsList');
  const scoreEl = document.getElementById('score');
  const weaknessesEl = document.getElementById('weaknesses');

  // Inicialização
  function init(){
    const saved = localStorage.getItem('simulado_contabil_v2');
    if(saved){
      try{
        const parsedState = JSON.parse(saved);
        if(parsedState.respostas.length === questoes.length){
            estado = parsedState;
        }
      }catch(e){
        console.error("Erro ao carregar estado salvo:", e);
      }
    }
    renderQuestion();
    updateControls();
    updateProgressUI();
  }

  function saveState(){localStorage.setItem('simulado_contabil_v2', JSON.stringify(estado));}

  function renderQuestion(){
    const q = questoes[estado.index];
    questionArea.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div>
          <div class="tag">ID ${q.id}</div>
          <div style="font-weight:600;margin-top:8px">${q.categoria} — <small style='color:var(--muted)'>${q.nivel}</small></div>
        </div>
        <div style="text-align:right;color:var(--muted)">Questão ${estado.index+1} de ${questoes.length}</div>
      </div>
      <h3 style="margin-top:12px">${escapeHtml(q.enunciado)}</h3>
      <div class="alternativas">
        ${q.alternativas.map((alt, i)=>{
          const selected = estado.respostas[estado.index] === i ? 'selected' : '';
          return `<div class="alt ${selected}" data-index="${i}">${String.fromCharCode(65+i)}) ${escapeHtml(alt)}</div>`
        }).join('')}
      </div>
      <div style="margin-top:10px;color:var(--muted);font-size:13px">${estado.respostas[estado.index] === null ? 'Você ainda não respondeu esta questão.' : 'Resposta marcada: ' + String.fromCharCode(65+estado.respostas[estado.index])}</div>
    `;

    document.querySelectorAll('.alt').forEach(el=>{
      el.addEventListener('click', ()=>{
        const choice = Number(el.getAttribute('data-index'));
        estado.respostas[estado.index] = choice;
        saveState();
        renderQuestion();
        updateProgressUI();
      });
    });
  }

  function updateControls(){
    prevBtn.disabled = estado.index === 0;
    nextBtn.disabled = estado.index === questoes.length-1;
  }

  prevBtn.addEventListener('click', ()=>{ if(estado.index>0){estado.index--; saveState(); renderQuestion(); updateControls();}});
  nextBtn.addEventListener('click', ()=>{ if(estado.index<questoes.length-1){estado.index++; saveState(); renderQuestion(); updateControls();}});
  resetBtn.addEventListener('click', ()=>{ if(confirm('Reiniciar respostas e progresso?')){estado = {index:0,respostas:Array(questoes.length).fill(null)}; saveState(); location.reload();}});

  submitBtn.addEventListener('click', ()=>{
    const naoRespondidas = estado.respostas.filter(r=>r===null).length;
    if(naoRespondidas>0){
      if(!confirm(`Você deixou ${naoRespondidas} questão(ões) em branco. Deseja enviar mesmo assim?`)) return;
    }
    computeResults();
  });

  function computeResults(){
    const total = questoes.length;
    let corretas = 0;
    const errosPorCategoria = {};
    const detalhes = [];

    questoes.forEach((q,i)=>{
      const resp = estado.respostas[i];
      const isCorrect = resp === q.correta;
      if(isCorrect) corretas++;
      else errosPorCategoria[q.categoria] = (errosPorCategoria[q.categoria]||0)+1;

      detalhes.push({q,resp,isCorrect});
    });

    const insights = [];
    if(corretas===total) insights.push('Excelente! Desempenho impecável. Continue com revisões pontuais.');
    else if(corretas/total >= 0.7) insights.push('Ótimo desempenho! Foque em revisar os detalhes das categorias onde errou.');
    else if(corretas/total >= 0.5) insights.push('Bom desempenho, mas há espaço para melhoria. Revise os conceitos básicos dos pontos fracos.');
    else insights.push('Atenção! Desempenho abaixo do esperado. É crucial reforçar o estudo teórico das categorias com erros.');
    
    const weaknesses = Object.keys(errosPorCategoria).map(cat=>({categoria:cat, erros:errosPorCategoria[cat], recomendacao: recomendacaoPorCategoria(cat)}));

    summaryEl.style.display='grid';
    const pct = Math.round((estado.respostas.filter(r=>r!==null).length/total)*100);
    progressBar.style.width = pct + '%';
    progressText.textContent = `${estado.respostas.filter(r=>r!==null).length} / ${total} respondidas`;
    correctText.textContent = `${corretas} corretas`;
    insightsList.innerHTML = insights.map(i=>`<div>• ${escapeHtml(i)}</div>`).join('');
    scoreEl.textContent = `${corretas} / ${total}`;
    if(weaknesses.length===0){ weaknessesEl.innerHTML = '<div style="color:var(--success)">Nenhuma fraqueza identificada. Parabéns!</div>'; }
    else{
      weaknessesEl.innerHTML = weaknesses.map(w=>`<div style="margin-bottom:8px"><strong>${escapeHtml(w.categoria)}</strong> — Erros: ${w.erros}<div style="color:var(--muted);font-size:13px;margin-top:4px">${escapeHtml(w.recomendacao)}</div></div>`).join('');
    }

    const detalhesHtml = detalhes.map((d,idx)=>{
      const status = d.isCorrect ? '✔ Correta' : '✖ Incorreta';
      const statusColor = d.isCorrect ? 'var(--success)' : 'var(--danger)';
      let suaRespostaHtml = '<em>Sem resposta</em>';
      if(d.resp !== null) {
        suaRespostaHtml = `${String.fromCharCode(65+d.resp)}) ${escapeHtml(questoes[idx].alternativas[d.resp])}`;
      }

      return `
        <div style="margin-top:12px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);">
          <div style="font-weight:600">Q${questoes[idx].id} — ${questoes[idx].categoria} <small style='color:var(--muted)'>(${questoes[idx].nivel})</small></div>
          <div style="margin-top:6px">${escapeHtml(questoes[idx].enunciado)}</div>
          <div style="margin-top:8px;color:${statusColor}">${status}</div>
          <div style="margin-top:6px;color:var(--muted);font-size:13px">Sua resposta: ${suaRespostaHtml}</div>
          <div style="margin-top:6px;color:var(--muted);font-size:13px">Gabarito: ${String.fromCharCode(65+questoes[idx].correta)}) ${escapeHtml(questoes[idx].alternativas[questoes[idx].correta])}</div>
          <div style="margin-top:8px;padding:8px; border-left: 2px solid var(--accent); color:var(--muted);font-size:13px"><b>Explicação:</b> ${escapeHtml(questoes[idx].explicacao)}</div>
        </div>
      `;
    }).join('');

    const existing = document.getElementById('detContainer');
    if(existing) existing.remove();
    
    const detailsContainer = document.createElement('div');
    detailsContainer.className='card';
    detailsContainer.style.marginTop='12px';
    detailsContainer.id = 'detContainer';
    detailsContainer.innerHTML = `<h3>Detalhamento das questões</h3>${detalhesHtml}`;
    document.getElementById('app').appendChild(detailsContainer);

    prevBtn.style.display = 'none';
    nextBtn.style.display = 'none';
    submitBtn.style.display = 'none';
    resetBtn.style.marginLeft = 'auto';
  }

  function recomendacaoPorCategoria(cat){
    const dicas = {
      'Contabilidade - CPC 16 (VRL)': 'Foque na fórmula do VRL (Preço de Venda - Custos de Conclusão - Despesas de Venda) e na regra de ouro: "custo ou VRL, o menor". Pratique exercícios de cálculo que envolvam o reconhecimento e a reversão de perdas.',
      'Contabilidade - PECLD': 'Entenda a natureza prospectiva do modelo de perdas esperadas. Estude como funciona a matriz de provisionamento para contas a receber e pratique os lançamentos contábeis de constituição, baixa e reversão da PECLD.',
      'Contabilidade - CPC 25 (Provisões)': 'Memorize os três critérios para reconhecer uma provisão (obrigação presente, saída provável, estimativa confiável). Saiba diferenciar claramente provisão, passivo contingente (divulgação) e ativo contingente.'
    };
    return dicas[cat] || 'Revisar o conteúdo teórico, priorizando questões comentadas e resumos estruturados.';
  }

  function updateProgressUI(){
    const total = questoes.length;
    const filled = estado.respostas.filter(r=>r!==null).length;
    const pct = filled > 0 ? Math.round((filled/total)*100) : 0;
    if (progressBar) progressBar.style.width = pct + '%';
    if (progressText) progressText.textContent = `${filled} / ${total} respondidas`;
    if (correctText) correctText.textContent = `-`;
  }

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]}); }

  init();
  </script>
</body>
</html>
